!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";const t=16,n=function(t,n,e,a=1){const r=t.getContext("2d"),o=(t=>(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1))(r);return t.width=n*o,t.height=e*o,t.style.width="100%",t.style.maxWidth=n*a+"px",r.setTransform(o,0,0,o,0,0),t},e=(t,n)=>{const e=new Image;return e.src=t,n&&e.addEventListener("load",(()=>n(e)),!1),e},a=(t,n,e=n)=>(a,r,o,i,d)=>a.drawImage(t,r*n,o*e,n,e,i*n,d*e,n,e),r=(t,n,e=n)=>{const a=t.width/n;let r=Math.floor(Math.random()*a);if(a>0){setInterval((()=>{r=(r+1)%a}),125)}return(a,o,i)=>a.drawImage(t,r*n,0,n,e,o*n,i*e,n,e)},o=(t,n=.2)=>(void 0===t.drawX&&(t.drawX=t.x),void 0===t.drawY&&(t.drawY=t.y),t.drawX<t.x&&(t.drawX+=Math.min(t.x-t.drawX,n)),t.drawY<t.y&&(t.drawY+=Math.min(t.y-t.drawY,n)),t.drawX>t.x&&(t.drawX-=Math.min(t.drawX-t.x,n)),t.drawY>t.y&&(t.drawY-=Math.min(t.drawY-t.y,n)),[t.drawX,t.drawY]);const i=(t,n,e,a)=>{const r=[];for(let o=n;o<a;o++)for(let n=t;n<e;n++)r.push([n,o]);return function(t){for(var n=t.length-1;n>0;n--){var e=Math.floor(Math.random()*(n+1)),a=t[n];t[n]=t[e],t[e]=a}}(r),r},d=e("img/tiles.png"),c=e("img/bat.png"),l=e("img/skeleton.png"),s=e("img/knight.png"),u=e("img/knight_flip.png"),m=e("img/slime.png"),h=e("img/coin.png"),w=a(d,t),f=(t,n)=>{const e=[];return t>1&&e.push([t-1,n]),n>1&&e.push([t,n-1]),t<6&&e.push([t+1,n]),n<8&&e.push([t,n+1]),(a=e)[Math.floor(Math.random()*a.length)];var a},g=(t,n)=>({name:"Stairs",draw:(t,n,e)=>w(t,8,1,n,e),x:t,y:n}),x=(n,e)=>({name:"Coin",draw:r(h,t),x:n,y:e}),y=(n,e)=>({name:"Bat",draw:r(c,t),turn:f,x:n,y:e}),p=(n,e)=>({name:"Skeleton",draw:r(l,t),turn:f,x:n,y:e}),M=(n,e)=>({name:"Slime",draw:r(m,t),turn:f,x:n,y:e});let k,v,E,S,X,Y,b={},R=0;function B(){S=!1,X=1.5,R++,document.getElementById("floor-hud").textContent=`${R}`;const t=i(1,1,7,9).filter((([t,n])=>Math.abs(t-Y.x)>1||Math.abs(n-Y.y)>1));E=[],[g,x,x,y,p,M].forEach((n=>{const[e,a]=t.pop();E.push(n(e,a))}))}window.addEventListener("keydown",(function(t){b[t.keyCode]=!0})),window.addEventListener("keyup",(function(t){b[t.keyCode]=!1})),(t=>{let n=null,e=null;document.addEventListener("touchstart",(t=>{const a=t.touches[0];n=a.clientX,e=a.clientY}),!1),document.addEventListener("touchmove",(a=>{if(!n||!e)return;const r=a.touches[0].clientX,o=a.touches[0].clientY,i=n-r,d=e-o;Math.abs(i)>Math.abs(d)?t(i>0?37:39):t(d>0?38:40),n=null,e=null}),!1)})((t=>{b[t]=!0})),window.addEventListener("load",(function(){k=((t,e,a,r)=>{const o=document.getElementById(t);n(o,e,a,r);const i=o.getContext("2d");return o.style.imageRendering="pixelated",i.imageSmoothingEnabled=!1,i})("root",128,160,3.5),v=a(d,t),Y=((n,e)=>{const a=[r(s,t),r(u,t)],o={name:"Knight",x:n,y:e,dir:0,draw:(...t)=>a[o.dir](...t)};return o})(2,2),B(),I()}));const C={37:()=>{Y.x>1&&Y.x--,Y.dir=1},38:()=>{Y.y>1&&Y.y--},39:()=>{Y.x<6&&Y.x++,Y.dir=0},40:()=>{Y.y<8&&Y.y++}};function I(){S||Object.entries(C).forEach((([t,n])=>{b[t]&&(b[t]=!1,n(),E.filter((t=>!!t.turn)).forEach((t=>{const[n,e]=t.turn(t.x,t.y);t.x=n,t.y=e})))})),k.clearRect(0,0,128,160);for(let t=1;t<9;t++)for(let n=1;n<7;n++)v(k,1,1,n,t);v(k,0,0,0,0);for(let t=1;t<7;t++)v(k,1,0,t,0);v(k,2,0,7,0),v(k,0,2,0,9);for(let t=1;t<7;t++)v(k,1,2,t,9);v(k,2,2,7,9);for(let t=0;t<9;t++)v(k,0,1,0,t);for(let t=0;t<9;t++)v(k,2,1,7,t);E.forEach((t=>{const[n,e]=o(t);t.draw(k,n,e)}));const[t,n]=o(Y);Y.draw(k,t,n);const e=E.find((t=>t.x===Y.x&&t.y===Y.y));e&&"Stairs"===e.name&&(S=!0),S?X<1?X+=Math.min(1-X,1/12):B():X>0&&(X-=Math.min(X,1/12)),X>0&&(k.fillStyle=`rgba(39, 29, 42, ${X})`,k.fillRect(0,0,128,160)),requestAnimationFrame(I)}}));
